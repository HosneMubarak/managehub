{% extends 'components/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Process Year-End Carry Over - ManageHub{% endblock %}

{% block styles %}
    <!-- dragula css-->
    <link rel="stylesheet" href="{% static 'assets/libs/dragula/dragula.min.css'%}">
<style>
    /* Enhanced Page Layout */
    .main-content {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        min-height: 100vh;
    }

    /* Professional Form Styling */
    .carry-over-form {
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
    }

    .carry-over-form:hover {
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        transform: translateY(-2px);
    }

    .form-section {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        border-radius: 12px;
        padding: 2rem;
        margin-bottom: 1.5rem;
        border: 1px solid rgba(13, 110, 253, 0.1);
        border-left: 4px solid #0d6efd;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .form-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, #0d6efd 0%, #6610f2 100%);
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .form-section:hover {
        border-left-color: #6610f2;
        background: linear-gradient(135deg, rgba(13, 110, 253, 0.02) 0%, rgba(13, 110, 253, 0.01) 100%);
        box-shadow: 0 4px 20px rgba(13, 110, 253, 0.1);
        transform: translateY(-1px);
    }

    .form-section:hover::before {
        opacity: 1;
    }

    .form-section-title {
        color: #495057;
        font-weight: 600;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid rgba(13, 110, 253, 0.1);
        display: flex;
        align-items: center;
        font-size: 1.1rem;
    }

    .form-section-title i {
        margin-right: 0.75rem;
        color: #0d6efd;
        font-size: 1.3rem;
        padding: 0.5rem;
        background: rgba(13, 110, 253, 0.1);
        border-radius: 8px;
    }

    /* Enhanced Help Cards */
    .help-card {
        background: linear-gradient(135deg, rgba(13, 110, 253, 0.02) 0%, rgba(13, 110, 253, 0.01) 100%);
        border: 1px solid rgba(13, 110, 253, 0.1);
        border-radius: 12px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .help-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(180deg, #0d6efd 0%, #6610f2 100%);
        transition: width 0.3s ease;
    }

    .help-card:hover {
        background: linear-gradient(135deg, rgba(13, 110, 253, 0.05) 0%, rgba(13, 110, 253, 0.02) 100%);
        box-shadow: 0 8px 25px rgba(13, 110, 253, 0.15);
        transform: translateY(-3px);
    }

    .help-card:hover::before {
        width: 6px;
    }

    /* Professional Step Indicators */
    .step-indicator {
        position: relative;
        padding-left: 1rem;
    }

    .step-indicator::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 2px;
        background: linear-gradient(180deg, #0d6efd 0%, #6610f2 100%);
        border-radius: 1px;
    }

    .step-number {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.875rem;
        transition: all 0.3s ease;
    }

    /* Enhanced Results Table */
    .results-table {
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .results-table thead th {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border: none;
        font-weight: 600;
        color: #495057;
        padding: 1.25rem 1rem;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        position: sticky;
        top: 0;
        z-index: 10;
    }

    .results-table tbody tr {
        border-bottom: 1px solid rgba(0,0,0,0.05);
        transition: all 0.2s ease;
    }

    .results-table tbody tr:hover {
        background-color: rgba(13, 110, 253, 0.02);
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .results-table tbody td {
        padding: 1.25rem 1rem;
        vertical-align: middle;
        border-bottom: none;
    }

    /* Professional Stats Cards */
    .stats-card {
        background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
        border: 1px solid rgba(0,0,0,0.05);
        border-left: 4px solid #0d6efd;
        border-radius: 0 12px 12px 0;
        padding: 1.5rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .stats-card::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 0;
        height: 100%;
        background: linear-gradient(135deg, rgba(13, 110, 253, 0.05) 0%, rgba(102, 16, 242, 0.05) 100%);
        transition: width 0.3s ease;
    }

    .stats-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 35px rgba(0,0,0,0.15);
        border-left-color: #6610f2;
    }

    .stats-card:hover::before {
        width: 100%;
    }

    .stats-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
    }

    .stats-card:hover .stats-icon {
        transform: scale(1.1) rotate(5deg);
    }

    /* Enhanced Alerts */
    .alert-enhanced {
        border: none;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        position: relative;
        overflow: hidden;
    }

    .alert-enhanced::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: currentColor;
    }

    /* Dark Mode Support */
    [data-theme-mode=dark] .main-content {
        background: linear-gradient(135deg, rgb(var(--body-bg-rgb)) 0%, rgba(255,255,255,0.02) 100%);
    }

    [data-theme-mode=dark] .form-section {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0.01) 100%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-left: 4px solid #0d6efd;
    }

    [data-theme-mode=dark] .form-section:hover {
        background: linear-gradient(135deg, rgba(13, 110, 253, 0.08) 0%, rgba(13, 110, 253, 0.04) 100%);
        box-shadow: 0 4px 20px rgba(13, 110, 253, 0.2);
    }

    [data-theme-mode=dark] .form-section-title {
        color: rgba(255, 255, 255, 0.9);
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }

    [data-theme-mode=dark] .help-card {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.02) 0%, rgba(255, 255, 255, 0.01) 100%);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    [data-theme-mode=dark] .help-card:hover {
        background: linear-gradient(135deg, rgba(13, 110, 253, 0.08) 0%, rgba(13, 110, 253, 0.04) 100%);
        box-shadow: 0 8px 25px rgba(13, 110, 253, 0.3);
    }

    [data-theme-mode=dark] .results-table {
        background: rgb(var(--body-bg-rgb));
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    [data-theme-mode=dark] .results-table thead th {
        background: linear-gradient(135deg, rgba(45, 45, 48, 0.9) 0%, rgba(35, 35, 38, 0.9) 100%);
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.8);
    }

    [data-theme-mode=dark] .results-table tbody tr {
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    [data-theme-mode=dark] .results-table tbody tr:hover {
        background-color: rgba(255, 255, 255, 0.02);
    }

    [data-theme-mode=dark] .stats-card {
        background: linear-gradient(135deg, rgb(var(--body-bg-rgb)) 0%, rgba(255,255,255,0.02) 100%);
        border: 1px solid rgba(255,255,255,0.1);
        border-left: 4px solid #0d6efd;
    }

    [data-theme-mode=dark] .stats-card:hover {
        border-left-color: #6610f2;
    }

    /* Animations */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes pulse {
        0%, 100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
    }

    .animate-fade-in {
        animation: fadeInUp 0.6s ease-out;
    }

    .animate-pulse {
        animation: pulse 2s infinite;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .form-section {
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .stats-card {
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .results-table thead th,
        .results-table tbody td {
            padding: 0.75rem 0.5rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="main-content app-content">
    <div class="container-fluid">
        
        <!-- Enhanced Page Header -->
        <div class="d-flex align-items-center justify-content-between page-header-breadcrumb flex-wrap gap-2 mb-4">
            <div>
                <nav>
                    <ol class="breadcrumb mb-1">
                        <li class="breadcrumb-item">
                            <a href="{% url 'dashboard:index' %}" class="text-decoration-none">
                                <i class="ri-home-line me-1"></i>Dashboard
                            </a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="{% url 'leaves:dashboard' %}" class="text-decoration-none">
                                <i class="ri-calendar-line me-1"></i>Leave Management
                            </a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">Process Carry Over</li>
                    </ol>
                </nav>
                <div class="d-flex align-items-center gap-3">
                    <h1 class="page-title fw-medium fs-18 mb-0">Year-End Carry Over Processing</h1>
                    <span class="badge bg-primary-transparent animate-pulse">
                        <i class="ri-time-line me-1"></i>Year-End Processing
                    </span>
                </div>
                <p class="text-muted mb-0 mt-1">Automatically process unused leave days from previous year</p>
            </div>
            <div class="btn-list">
                <a href="{% url 'leaves:entitlements' %}" class="btn btn-light btn-wave">
                    <i class="ri-arrow-left-line me-1"></i>Back to Entitlements
                </a>
                <a href="{% url 'leaves:dashboard' %}" class="btn btn-outline-primary btn-wave">
                    <i class="ri-dashboard-line me-1"></i>Dashboard
                </a>
            </div>
        </div>
        <!-- Page Header Close -->

        <!-- Start::row-1 -->
        <div class="row row-sm mt-lg-4">
            <!-- Main Form -->
            <div class="col-xl-8">
                <div class="card custom-card carry-over-form animate-fade-in">
                    <div class="card-header d-flex align-items-center justify-content-between p-4 border-bottom">
                        <div class="card-title mb-0 d-flex align-items-center">
                            <div class="avatar avatar-sm bg-primary-transparent me-3">
                                <i class="ri-calendar-event-line fs-16"></i>
                            </div>
                            <div>
                                <span class="fw-semibold fs-16">Process Year-End Carry Over</span>
                                <p class="text-muted mb-0 fs-12">Configure and execute carry over processing</p>
                            </div>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge bg-info-transparent fs-11">
                                <i class="ri-shield-check-line me-1"></i>Safe Processing
                            </span>
                        </div>
                    </div>
                    <div class="card-body p-4">
                        <!-- Enhanced Info Alert -->
                        <div class="alert alert-primary alert-enhanced border-0 mb-4" style="background: linear-gradient(135deg, rgba(13, 110, 253, 0.08) 0%, rgba(13, 110, 253, 0.04) 100%);">
                            <div class="d-flex align-items-start">
                                <div class="avatar avatar-sm bg-primary-transparent me-3 mt-1">
                                    <i class="ri-information-line fs-14"></i>
                                </div>
                                <div class="flex-fill">
                                    <h6 class="fw-semibold mb-2 text-primary d-flex align-items-center">
                                        <i class="ri-lightbulb-line me-2"></i>About Carry Over Processing
                                    </h6>
                                    <p class="mb-2 text-muted fs-13">
                                        This process automatically calculates unused leave days from the previous year 
                                        and carries them over to the selected year. Only annual leave entitlement days 
                                        can be carried over (not TIL or previously carried over days).
                                    </p>
                                    <div class="d-flex flex-wrap gap-2 mt-2">
                                        <span class="badge bg-success-transparent fs-11">
                                            <i class="ri-check-line me-1"></i>Automatic Calculation
                                        </span>
                                        <span class="badge bg-info-transparent fs-11">
                                            <i class="ri-shield-line me-1"></i>Safe Processing
                                        </span>
                                        <span class="badge bg-warning-transparent fs-11">
                                            <i class="ri-eye-line me-1"></i>Preview Available
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Enhanced Processing Form -->
                        <div class="form-section">
                            <h6 class="form-section-title">
                                <i class="ri-settings-3-line"></i>Processing Configuration
                            </h6>
                            <form method="post" class="row g-4">
                                {% csrf_token %}
                            
                            <div class="col-md-6">
                                <label class="form-label fw-medium">
                                    <i class="ri-calendar-line me-2 text-primary"></i>Target Year
                                    <span class="text-danger">*</span>
                                </label>
                                <select name="year" class="form-select form-select-lg" required>
                                    {% for yr in years %}
                                        <option value="{{ yr }}" {% if yr == year %}selected{% endif %}>{{ yr }}</option>
                                    {% endfor %}
                                </select>
                                <div class="form-text">
                                    <i class="ri-information-line me-1"></i>Year to process carry over for
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-medium">
                                    <i class="ri-time-line me-2 text-warning"></i>Maximum Carry Over Days
                                </label>
                                <input type="number" name="max_carry_over" class="form-control form-control-lg" 
                                       step="0.5" min="0" placeholder="No limit" value="{{ max_carry_over }}">
                                <div class="form-text">
                                    <i class="ri-information-line me-1"></i>Maximum days that can be carried over (optional)
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-check form-check-lg">
                                            <input class="form-check-input" type="checkbox" name="dry_run" id="dry_run" 
                                                   {% if dry_run %}checked{% endif %}>
                                            <label class="form-check-label fw-medium" for="dry_run">
                                                <i class="ri-eye-line me-2 text-info"></i>Dry Run (Preview only, don't save changes)
                                            </label>
                                            <div class="form-text">Test the process without making actual changes</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check form-check-lg">
                                            <input class="form-check-input" type="checkbox" name="force" id="force">
                                            <label class="form-check-label fw-medium" for="force">
                                                <i class="ri-alert-line me-2 text-warning"></i>Force processing (override existing carry over values)
                                            </label>
                                            <div class="form-text">Override existing carry over values if they exist</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                                <div class="col-12 mt-4">
                                    <div class="d-flex gap-3 flex-wrap">
                                        <button type="submit" class="btn btn-primary btn-wave btn-lg">
                                            <i class="ri-play-line me-2"></i>Process Carry Over
                                        </button>
                                        <button type="button" class="btn btn-info btn-wave btn-lg" onclick="this.form.dry_run.checked=true; this.form.submit();">
                                            <i class="ri-eye-line me-2"></i>Preview (Dry Run)
                                        </button>
                                        <a href="{% url 'leaves:entitlements' %}" class="btn btn-light btn-wave btn-lg">
                                            <i class="ri-arrow-left-line me-2"></i>Cancel
                                        </a>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Help Cards -->
            <div class="col-xl-4">
                <!-- How It Works Card -->
                <div class="card custom-card help-card mb-4 animate-fade-in" style="animation-delay: 0.2s;">
                    <div class="card-header d-flex align-items-center p-4 border-bottom">
                        <div class="avatar avatar-sm bg-warning-transparent me-3">
                            <i class="ri-lightbulb-line fs-16"></i>
                        </div>
                        <div class="card-title mb-0">
                            <span class="fw-semibold">How It Works</span>
                            <p class="text-muted mb-0 fs-12">Step-by-step process</p>
                        </div>
                    </div>
                    <div class="card-body p-4">
                        <div class="step-indicator">
                            <div class="d-flex flex-column gap-4">
                                <div class="d-flex align-items-start gap-3">
                                    <div class="step-number bg-primary-transparent text-primary">1</div>
                                    <div class="flex-fill">
                                        <div class="fw-medium fs-14 text-dark mb-1">Calculate Unused Days</div>
                                        <div class="text-muted fs-13">
                                            System calculates unused annual leave days from the previous year
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="d-flex align-items-start gap-3">
                                    <div class="step-number bg-success-transparent text-success">2</div>
                                    <div class="flex-fill">
                                        <div class="fw-medium fs-14 text-dark mb-1">Apply Limits</div>
                                        <div class="text-muted fs-13">
                                            If maximum carry over is set, unused days are capped at that limit
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="d-flex align-items-start gap-3">
                                    <div class="step-number bg-info-transparent text-info">3</div>
                                    <div class="flex-fill">
                                        <div class="fw-medium fs-14 text-dark mb-1">Update Entitlements</div>
                                        <div class="text-muted fs-13">
                                            Carried over days are added to the target year's entitlement
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Safety Features Card -->
                <div class="card custom-card help-card animate-fade-in" style="animation-delay: 0.4s;">
                    <div class="card-header d-flex align-items-center p-4 border-bottom">
                        <div class="avatar avatar-sm bg-success-transparent me-3">
                            <i class="ri-shield-check-line fs-16"></i>
                        </div>
                        <div class="card-title mb-0">
                            <span class="fw-semibold">Safety Features</span>
                            <p class="text-muted mb-0 fs-12">Built-in protections</p>
                        </div>
                    </div>
                    <div class="card-body p-4">
                        <div class="d-flex flex-column gap-3">
                            <div class="d-flex align-items-center gap-3">
                                <div class="avatar avatar-xs bg-success-transparent rounded-circle">
                                    <i class="ri-check-line fs-10 text-success"></i>
                                </div>
                                <div class="flex-fill">
                                    <span class="fs-13 text-dark fw-medium">Dry run mode for testing</span>
                                    <div class="text-muted fs-12">Preview changes before applying</div>
                                </div>
                            </div>
                            <div class="d-flex align-items-center gap-3">
                                <div class="avatar avatar-xs bg-success-transparent rounded-circle">
                                    <i class="ri-check-line fs-10 text-success"></i>
                                </div>
                                <div class="flex-fill">
                                    <span class="fs-13 text-dark fw-medium">Prevents negative carry over</span>
                                    <div class="text-muted fs-12">Only positive unused days are carried</div>
                                </div>
                            </div>
                            <div class="d-flex align-items-center gap-3">
                                <div class="avatar avatar-xs bg-success-transparent rounded-circle">
                                    <i class="ri-check-line fs-10 text-success"></i>
                                </div>
                                <div class="flex-fill">
                                    <span class="fs-13 text-dark fw-medium">Only processes annual entitlement</span>
                                    <div class="text-muted fs-12">Excludes TIL and previous carry overs</div>
                                </div>
                            </div>
                            <div class="d-flex align-items-center gap-3">
                                <div class="avatar avatar-xs bg-success-transparent rounded-circle">
                                    <i class="ri-check-line fs-10 text-success"></i>
                                </div>
                                <div class="flex-fill">
                                    <span class="fs-13 text-dark fw-medium">Detailed processing reports</span>
                                    <div class="text-muted fs-12">Complete audit trail of changes</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Results Section -->
        {% if results %}
        <div class="row mt-4">
            <div class="col-12">
                <div class="card custom-card animate-fade-in" style="animation-delay: 0.6s;">
                    <div class="card-header d-flex align-items-center justify-content-between p-4 border-bottom">
                        <div class="card-title mb-0 d-flex align-items-center">
                            <div class="avatar avatar-sm bg-success-transparent me-3">
                                <i class="ri-file-list-3-line fs-16"></i>
                            </div>
                            <div>
                                <span class="fw-semibold fs-16">Processing Results</span>
                                <p class="text-muted mb-0 fs-12">
                                    {% if dry_run %}Preview Results (No Changes Made){% else %}Processing Complete{% endif %}
                                </p>
                            </div>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            {% if dry_run %}
                                <span class="badge bg-info-transparent">
                                    <i class="ri-eye-line me-1"></i>Dry Run
                                </span>
                            {% else %}
                                <span class="badge bg-success-transparent">
                                    <i class="ri-check-line me-1"></i>Completed
                                </span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="card-body p-4">
                        <!-- Enhanced Summary Stats -->
                        <div class="row mb-4">
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="stats-card">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div>
                                            <div class="stats-icon bg-primary-transparent text-primary">
                                                <i class="ri-user-line"></i>
                                            </div>
                                            <h4 class="fw-bold mb-1">{{ results.processed_employees }}</h4>
                                            <p class="text-muted mb-0 fs-13">Employees Processed</p>
                                        </div>
                                        <div class="text-end">
                                            <span class="badge bg-primary-transparent fs-11">Total</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="stats-card">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div>
                                            <div class="stats-icon bg-success-transparent text-success">
                                                <i class="ri-calendar-check-line"></i>
                                            </div>
                                            <h4 class="fw-bold mb-1">{{ results.employees_with_carry_over|length }}</h4>
                                            <p class="text-muted mb-0 fs-13">With Carry Over</p>
                                        </div>
                                        <div class="text-end">
                                            <span class="badge bg-success-transparent fs-11">Success</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="stats-card">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div>
                                            <div class="stats-icon bg-info-transparent text-info">
                                                <i class="ri-time-line"></i>
                                            </div>
                                            <h4 class="fw-bold mb-1">{{ results.total_days_carried_over }}</h4>
                                            <p class="text-muted mb-0 fs-13">Total Days Carried</p>
                                        </div>
                                        <div class="text-end">
                                            <span class="badge bg-info-transparent fs-11">Days</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="stats-card">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div>
                                            <div class="stats-icon bg-warning-transparent text-warning">
                                                <i class="ri-error-warning-line"></i>
                                            </div>
                                            <h4 class="fw-bold mb-1">{{ results.errors|length }}</h4>
                                            <p class="text-muted mb-0 fs-13">Errors</p>
                                        </div>
                                        <div class="text-end">
                                            {% if results.errors|length > 0 %}
                                                <span class="badge bg-danger-transparent fs-11">Issues</span>
                                            {% else %}
                                                <span class="badge bg-success-transparent fs-11">Clean</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Employees with Carry Over -->
                        {% if results.employees_with_carry_over %}
                        <div class="mb-4">
                            <h6 class="fw-medium mb-3">
                                <i class="ri-check-double-line me-1 text-success"></i>
                                Employees with Carry Over ({{ results.employees_with_carry_over|length }})
                            </h6>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Employee</th>
                                            <th>Unused Days</th>
                                            <th>Carried Over</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for emp in results.employees_with_carry_over %}
                                        <tr>
                                            <td>{{ emp.employee }}</td>
                                            <td>{{ emp.unused_days }} days</td>
                                            <td>{{ emp.carried_over_days }} days</td>
                                            <td>
                                                {% if emp.capped %}
                                                    <span class="badge bg-warning-transparent">Capped</span>
                                                {% else %}
                                                    <span class="badge bg-success-transparent">Full</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Employees without Previous Year -->
                        {% if results.employees_without_previous_year %}
                        <div class="mb-4">
                            <h6 class="fw-medium mb-3">
                                <i class="ri-information-line me-1 text-info"></i>
                                Employees without Previous Year Entitlement ({{ results.employees_without_previous_year|length }})
                            </h6>
                            <div class="d-flex flex-wrap gap-2">
                                {% for emp in results.employees_without_previous_year %}
                                    <span class="badge bg-info-transparent">{{ emp }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}

                        <!-- Errors -->
                        {% if results.errors %}
                        <div class="mb-4">
                            <h6 class="fw-medium mb-3">
                                <i class="ri-error-warning-line me-1 text-danger"></i>
                                Processing Errors ({{ results.errors|length }})
                            </h6>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Employee</th>
                                            <th>Error</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for error in results.errors %}
                                        <tr>
                                            <td>{{ error.employee }}</td>
                                            <td class="text-danger">{{ error.error }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

    </div>
</div>
{% endblock %}
