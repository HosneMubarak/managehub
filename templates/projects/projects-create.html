
{% extends 'components/base.html' %}
{% load static %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'assets/libs/quill/quill.snow.css'%}">
    <link rel="stylesheet" href="{% static 'assets/libs/quill/quill.bubble.css'%}">
    <link rel="stylesheet" href="{% static 'assets/libs/filepond/filepond.min.css'%}">
    <link rel="stylesheet" href="{% static 'assets/libs/filepond-plugin-image-preview/filepond-plugin-image-preview.min.css'%}">
    <link rel="stylesheet" href="{% static 'assets/libs/filepond-plugin-image-edit/filepond-plugin-image-edit.min.css'%}">
{% endblock %}

{% block content %}
    <!-- Page Header -->
    <div class="d-flex align-items-center justify-content-between page-header-breadcrumb flex-wrap gap-2">
        <div>
            <nav>
                <ol class="breadcrumb mb-1">
                    <li class="breadcrumb-item"><a href="{% url 'dashboard:index' %}">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'projects:list' %}">Projects</a></li>
                    <li class="breadcrumb-item active" aria-current="page">{% if form.instance.pk %}Edit Project{% else %}Create Project{% endif %}</li>
                </ol>
            </nav>
            <h1 class="page-title fw-medium fs-18 mb-0">{% if form.instance.pk %}Edit Project{% else %}Create Project{% endif %}</h1>
        </div>
        <div class="btn-list">
            <a href="{% url 'projects:list' %}" class="btn btn-white btn-wave">
                <i class="ri-arrow-left-line align-middle me-1 lh-1"></i> Back to Projects
            </a>
        </div>
    </div>
    <!-- Page Header Close -->

    <!-- Start::row-1 -->
    <div class="row">
        <div class="col-xl-12">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="card custom-card">
                    <div class="card-header">
                        <div class="card-title">
                            {% if form.instance.pk %}Edit Project{% else %}Create Project{% endif %}
                        </div>
                    </div>
                    <div class="card-body">
                        {% if form.errors %}
                            <div class="alert alert-danger">
                                <strong>Please correct the following errors:</strong>
                                <ul class="mb-0">
                                    {% for field, errors in form.errors.items %}
                                        {% for error in errors %}
                                            <li>{{ field|title }}: {{ error }}</li>
                                        {% endfor %}
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}

                        <div class="row">
                            <!-- Basic Information -->
                            <div class="col-xl-6">
                                <div class="mb-3">
                                    <label for="{{ form.project_id.id_for_label }}" class="form-label">Project ID <span class="text-danger">*</span></label>
                                    {{ form.project_id }}
                                    {% if form.project_id.help_text %}
                                        <div class="form-text">{{ form.project_id.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-xl-6">
                                <div class="mb-3">
                                    <label for="{{ form.name.id_for_label }}" class="form-label">Project Name <span class="text-danger">*</span></label>
                                    {{ form.name }}
                                    {% if form.name.help_text %}
                                        <div class="form-text">{{ form.name.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-xl-12">
                                <div class="mb-3">
                                    <label for="{{ form.description.id_for_label }}" class="form-label">Description</label>
                                    {{ form.description }}
                                    {% if form.description.help_text %}
                                        <div class="form-text">{{ form.description.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Categorization -->
                        <div class="row">
                            <div class="col-xl-6">
                                <div class="mb-3">
                                    <label for="{{ form.business_area.id_for_label }}" class="form-label">Business Area <span class="text-danger">*</span></label>
                                    {{ form.business_area }}
                                    {% if form.business_area.help_text %}
                                        <div class="form-text">{{ form.business_area.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-xl-6">
                                <div class="mb-3">
                                    <label for="{{ form.project_type.id_for_label }}" class="form-label">Project Type <span class="text-danger">*</span></label>
                                    {{ form.project_type }}
                                    {% if form.project_type.help_text %}
                                        <div class="form-text">{{ form.project_type.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Management -->
                        <div class="row">
                            <div class="col-xl-4">
                                <div class="mb-3">
                                    <label for="{{ form.project_manager.id_for_label }}" class="form-label">Project Manager <span class="text-danger">*</span></label>
                                    {{ form.project_manager }}
                                    {% if form.project_manager.help_text %}
                                        <div class="form-text">{{ form.project_manager.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-xl-4">
                                <div class="mb-3">
                                    <label for="{{ form.priority.id_for_label }}" class="form-label">Priority <span class="text-danger">*</span></label>
                                    {{ form.priority }}
                                    {% if form.priority.help_text %}
                                        <div class="form-text">{{ form.priority.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-xl-4">
                                <div class="mb-3">
                                    <label for="{{ form.status.id_for_label }}" class="form-label">Status <span class="text-danger">*</span></label>
                                    {{ form.status }}
                                    {% if form.status.help_text %}
                                        <div class="form-text">{{ form.status.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-xl-6">
                                <div class="mb-3">
                                    <label for="{{ form.effort_size.id_for_label }}" class="form-label">Effort Size</label>
                                    {{ form.effort_size }}
                                    {% if form.effort_size.help_text %}
                                        <div class="form-text">{{ form.effort_size.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Timeline -->
                        <div class="row">
                            <div class="col-xl-4">
                                <div class="mb-3">
                                    <label for="{{ form.start_date.id_for_label }}" class="form-label">Start Date</label>
                                    <div class="form-group">
                                        <div class="input-group">
                                            <div class="input-group-text text-muted">
                                                <i class="ri-calendar-line"></i>
                                            </div>
                                            {{ form.start_date }}
                                        </div>
                                    </div>
                                    {% if form.start_date.help_text %}
                                        <div class="form-text">{{ form.start_date.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-xl-4">
                                <div class="mb-3">
                                    <label for="{{ form.estimated_end_date.id_for_label }}" class="form-label">Estimated End Date</label>
                                    <div class="form-group">
                                        <div class="input-group">
                                            <div class="input-group-text text-muted">
                                                <i class="ri-calendar-line"></i>
                                            </div>
                                            {{ form.estimated_end_date }}
                                        </div>
                                    </div>
                                    {% if form.estimated_end_date.help_text %}
                                        <div class="form-text">{{ form.estimated_end_date.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-xl-4">
                                <div class="mb-3">
                                    <label for="{{ form.actual_end_date.id_for_label }}" class="form-label">Actual End Date</label>
                                    <div class="form-group">
                                        <div class="input-group">
                                            <div class="input-group-text text-muted">
                                                <i class="ri-calendar-line"></i>
                                            </div>
                                            {{ form.actual_end_date }}
                                        </div>
                                    </div>
                                    {% if form.actual_end_date.help_text %}
                                        <div class="form-text">{{ form.actual_end_date.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-xl-4">
                                <div class="mb-3">
                                    <label for="{{ form.week_commencing.id_for_label }}" class="form-label">Week Commencing</label>
                                    {{ form.week_commencing }}
                                    {% if form.week_commencing.help_text %}
                                        <div class="form-text">{{ form.week_commencing.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-xl-4">
                                <div class="mb-3">
                                    <label for="{{ form.t_code.id_for_label }}" class="form-label">T/Code</label>
                                    {{ form.t_code }}
                                    {% if form.t_code.help_text %}
                                        <div class="form-text">{{ form.t_code.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-xl-4">
                                <div class="mb-3">
                                    <label for="{{ form.ipbss_remedy.id_for_label }}" class="form-label">IPBSS Remedy</label>
                                    {{ form.ipbss_remedy }}
                                    {% if form.ipbss_remedy.help_text %}
                                        <div class="form-text">{{ form.ipbss_remedy.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Additional Project Details -->
                        <div class="row">
                            <div class="col-xl-6">
                                <div class="mb-3">
                                    <label for="{{ form.clarity.id_for_label }}" class="form-label">Clarity</label>
                                    {{ form.clarity }}
                                    {% if form.clarity.help_text %}
                                        <div class="form-text">{{ form.clarity.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-xl-6">
                                <div class="mb-3">
                                    <label for="{{ form.timeline.id_for_label }}" class="form-label">Timeline</label>
                                    {{ form.timeline }}
                                    {% if form.timeline.help_text %}
                                        <div class="form-text">{{ form.timeline.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Team Assignment -->
                        <div class="row">
                            <div class="col-xl-12">
                                <div class="mb-3">
                                    <label class="form-label">Team Members</label>
                                    <div class="row">
                                        {% for user in form.assigned_users %}
                                            <div class="col-md-4 col-lg-3">
                                                <div class="form-check">
                                                    {{ user.tag }}
                                                    <label class="form-check-label" for="{{ user.id_for_label }}">
                                                        {{ user.choice_label }}
                                                    </label>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                    {% if form.assigned_users.help_text %}
                                        <div class="form-text">{{ form.assigned_users.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- Removed has_clarity and is_template fields -->
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="d-flex justify-content-end gap-2">
                            <a href="{% url 'projects:list' %}" class="btn btn-light">Cancel</a>
                            <button type="submit" class="btn btn-primary">
                                {% if form.instance.pk %}Update Project{% else %}Create Project{% endif %}
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- End::row-1 -->

{% endblock %}

{% block scripts %}
    <script src="{% static 'assets/libs/quill/quill.min.js'%}"></script>
    <script src="{% static 'assets/js/quill-editor.js'%}"></script>
    <script src="{% static 'assets/libs/filepond/filepond.min.js'%}"></script>
    <script src="{% static 'assets/libs/filepond-plugin-image-preview/filepond-plugin-image-preview.min.js'%}"></script>
    <script src="{% static 'assets/libs/filepond-plugin-image-exif-orientation/filepond-plugin-image-exif-orientation.min.js'%}"></script>
    <script src="{% static 'assets/libs/filepond-plugin-file-validate-size/filepond-plugin-file-validate-size.min.js'%}"></script>
    <script src="{% static 'assets/libs/filepond-plugin-file-encode/filepond-plugin-file-encode.min.js'%}"></script>
    <script src="{% static 'assets/libs/filepond-plugin-image-edit/filepond-plugin-image-edit.min.js'%}"></script>
    <script src="{% static 'assets/libs/filepond-plugin-file-validate-type/filepond-plugin-file-validate-type.min.js'%}"></script>
    <script src="{% static 'assets/libs/filepond-plugin-image-crop/filepond-plugin-image-crop.min.js'%}"></script>
    <script src="{% static 'assets/libs/filepond-plugin-image-resize/filepond-plugin-image-resize.min.js'%}"></script>
    <script src="{% static 'assets/libs/filepond-plugin-image-transform/filepond-plugin-image-transform.min.js'%}"></script>
    <script src="{% static 'assets/js/filepond.js'%}"></script>
{% endblock %}
